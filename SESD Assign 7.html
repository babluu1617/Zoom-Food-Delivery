<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zoom Food Delivery App - OO Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .page { display: none; }
        .page.active { display: block; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ef4444; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #dc2626; }
        .animate-pulse-slow { animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 50% { opacity: .5; } }
        #map { height: 256px; width: 100%; }
        @media (min-width: 768px) { #map { height: 100%; min-height: 400px; } }
        .cart-icon-container svg { transition: transform 0.2s ease-in-out, stroke 0.2s ease-in-out; cursor: pointer; }
        .cart-icon-container:hover svg { transform: scale(1.15); stroke: #ef4444; }
        .form-input { @apply w-full p-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-red-500; }
    </style>
</head>
<body class="bg-red-50">

    <div id="splash-screen" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center transition-opacity duration-500 ease-in-out">
        <div class="animate-pulse-slow">
            <svg xmlns="http://www.w3.org/2000/svg" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-utensils-crossed"><path d="m16 2-2.3 2.3a3 3 0 0 0 0 4.2l1.8 1.8a3 3 0 0 0 4.2 0L22 8Z"/><path d="m15 15-3.3-3.3a4 4 0 0 0-5.7 0l-1.8 1.8a4 4 0 0 0 0 5.7L8 22Z"/><path d="m2 16 6 6"/><path d="m8 2 1.3 1.3a3 3 0 0 0 4.2 0l1.8-1.8a3 3 0 0 0 0-4.2L13 0"/></svg>
        </div>
        <h1 class="text-3xl font-bold text-red-600 mt-4">Zoom Delivery</h1>
        <p class="text-gray-500 text-lg mt-1">Food at your doorstep in Zapp time!</p>
    </div>

    <div id="app-container" class="max-w-md mx-auto bg-white shadow-lg h-screen overflow-y-auto md:max-w-4xl md:rounded-2xl md:my-8 md:h-auto">
        <header id="main-header" class="sticky top-0 bg-white p-4 z-10 shadow-md flex justify-between items-center md:rounded-t-2xl">
            <div id="header-content">
                </div>
            <div class="relative cart-icon-container">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-cart" onclick="handleNavigate('cart')"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.16"/></svg>
                <span id="cart-item-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full h-5 w-5 flex items-center justify-center">0</span>
            </div>
        </header>

        <main class="p-4 md:p-8">
            <div id="page-home" class="page active">
                <div class="relative mb-6">
                    <input type="text" id="search-input" placeholder="Search for restaurants or dishes" class="w-full p-3 pl-10 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" autocomplete="off">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                    <div id="search-results" class="absolute top-full left-0 right-0 bg-white border rounded-b-lg shadow-lg z-20 hidden max-h-96 overflow-y-auto"></div>
                </div>
                
                <h2 class="text-xl font-bold mb-4">Inspiration for your first order</h2>
                <div class="grid grid-cols-4 md:grid-cols-8 gap-4 mb-8 text-center" id="categories-container"></div>

                <h2 class="text-xl font-bold mb-4">Top-rated restaurants near you</h2>
                <div id="restaurant-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>

            <div id="page-restaurant" class="page">
                <div id="restaurant-detail-content"></div>
            </div>

            <div id="page-cart" class="page">
                <h2 class="text-2xl font-bold mb-4">Order Summary</h2>
                <div class="md:flex md:gap-8">
                    <div class="md:w-2/3">
                        <div id="cart-items" class="space-y-4"></div>
                         <div id="empty-cart" class="text-center py-12">
                            <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-shopping-basket mx-auto text-gray-300"><path d="m5 11 4-7"/><path d="m19 11-4-7"/><path d="M2 11h20"/><path d="m3.5 11 1.6 7.4a2 2 0 0 0 2 1.6h9.8c.9 0 1.8-.7 2-1.6l1.7-7.4"/><path d="m9 11 1 9"/><path d="M4.5 15.5h15"/><path d="m15 11-1 9"/></svg>
                            <p class="mt-4 text-gray-500">Your cart is empty. Add some delicious food!</p>
                        </div>
                    </div>
                    <div class="md:w-1/3">
                        <div id="payment-section" class="mt-8 md:mt-0 border-t md:border-none pt-4 md:pt-0 hidden md:block md:sticky md:top-24">
                            
                            <h3 class="text-xl font-semibold mb-4">Delivery Options</h3>
                            <div class="space-y-3" onchange="handleDeliveryStrategyChange(event)">
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                                    <input type="radio" name="delivery" class="mr-3" value="standard" checked> 
                                    Standard Delivery (30-40 min)
                                </label>
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                                    <input type="radio" name="delivery" class="mr-3" value="express"> 
                                    Express Delivery (15-20 min)
                                </label>
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer">
                                    <input type="radio" name="delivery" class="mr-3" value="free"> 
                                    Free Delivery (Coupon)
                                </label>
                            </div>

                            <h3 class="text-xl font-semibold mt-6 mb-4">Bill Details</h3>
                            <div id="bill-details" class="space-y-2 text-gray-600"></div>
                            
                            <div class="mt-6">
                                <h3 class="text-xl font-semibold mb-4">Payment Method</h3>
                                <div class="space-y-3">
                                   <label class="flex items-center p-3 border rounded-lg cursor-pointer"><input type="radio" name="payment" class="mr-3" value="card" checked> Credit/Debit Card</label>
                                   <label class="flex items-center p-3 border rounded-lg cursor-pointer"><input type="radio" name="payment" class="mr-3" value="upi"> UPI</label>
                                   <label class="flex items-center p-3 border rounded-lg cursor-pointer"><input type="radio" name="payment" class="mr-3" value="cod"> Cash on Delivery</label>
                                </div>
                            </div>
                            <button onclick="handlePlaceOrder()" class="w-full bg-red-600 text-white font-bold py-3 rounded-lg mt-8 hover:bg-red-700 transition-colors">
                                Place Order
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="page-tracking" class="page">
                <div class="text-center">
                    <h2 class="text-2xl font-bold mb-2">Order Confirmed!</h2>
                    <p class="text-gray-500 mb-6">Your order is on its way. Follow its journey below.</p>
                </div>
                <div class="md:flex md:gap-8">
                    <div class="md:w-1/2">
                         <div id="map" class="rounded-lg overflow-hidden mb-6 md:mb-0 z-0"></div>
                        <div id="delivery-status" class="text-center font-semibold my-4 text-lg md:hidden"></div>
                    </div>
                    <div class="md:w-1/2">
                        <div id="delivery-status-desktop" class="text-center font-semibold mb-6 text-lg hidden md:block"></div>
                        
                        <div id="agent-details" class="mb-6">
                            </div>

                        <div id="tracking-status" class="space-y-6"></div>
                    </div>
                </div>
            </div>

        </main>
    </div>

<div id="card-modal" class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">Enter Card Details</h3>
            <button onclick="handleHideModals()" class="text-gray-500 hover:text-gray-800">&times;</button>
        </div>
        <form onsubmit="event.preventDefault(); handleConfirmOrder();">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Name on Card</label>
                    <input type="text" class="form-input" placeholder="John Doe" required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Card Number</label>
                    <input type="text" class="form-input" placeholder="0000 0000 0000 0000" required>
                </div>
                <div class="flex gap-4">
                    <div class="w-1/2">
                        <label class="block text-sm font-medium text-gray-700">Expiry Date</label>
                        <input type="text" class="form-input" placeholder="MM/YY" required>
                    </div>
                    <div class="w-1/2">
                        <label class="block text-sm font-medium text-gray-700">CVV</label>
                        <input type="text" class="form-input" placeholder="123" required>
                    </div>
                </div>
            </div>
            <div class="mt-6 flex justify-between items-center">
                <button type="button" onclick="handleHideModals()" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancel</button>
                <button type="submit" class="px-6 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700">
                    Pay <span id="card-modal-amount"></span>
                </button>
            </div>
        </form>
    </div>
</div>

<div id="upi-modal" class="fixed inset-0 bg-black bg-opacity-50 z-40 flex items-center justify-center p-4 hidden">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-xl font-semibold">Choose UPI Option</h3>
            <button onclick="handleHideModals()" class="text-gray-500 hover:text-gray-800">&times;</button>
        </div>
        <div class="space-y-4">
            <p class="text-lg font-bold text-center">Pay <span id="upi-modal-amount"></span></p>
            <div class="grid grid-cols-3 gap-4 text-center">
                <div onclick="handleConfirmOrder()" class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
                    <img src="https://placehold.co/48x48/white/6d28d9?text=G" alt="GPay" class="mx-auto h-12 w-12 rounded-full bg-purple-100">
                    <p class="text-sm font-medium mt-1">Google Pay</p>
                </div>
                <div onclick="handleConfirmOrder()" class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
                    <img src="https://placehold.co/48x48/white/1e40af?text=P" alt="PhonePe" class="mx-auto h-12 w-12 rounded-full bg-blue-100">
                    <p class="text-sm font-medium mt-1">PhonePe</p>
                </div>
                <div onclick="handleConfirmOrder()" class="p-3 border rounded-lg cursor-pointer hover:bg-gray-100">
                    <img src="https://placehold.co/48x48/white/0ea5e9?text=P" alt="Paytm" class="mx-auto h-12 w-12 rounded-full bg-cyan-100">
                    <p class="text-sm font-medium mt-1">Paytm</p>
                </div>
            </div>

            <div class="relative flex items-center justify-center my-4">
                <div class="absolute inset-0 flex items-center"><span class="w-full border-t"></span></div>
                <span class="relative bg-white px-2 text-sm text-gray-500">OR</span>
            </div>

            <form onsubmit="event.preventDefault(); handleConfirmOrder();">
                <label class="block text-sm font-medium text-gray-700">Enter UPI ID</label>
                <div class="flex gap-2 mt-1">
                    <input type="text" class="form-input" placeholder="yourname@bank" required>
                    <button type="submit" class="px-4 py-2 bg-red-600 text-white font-bold rounded-lg hover:bg-red-700 whitespace-nowrap">Verify & Pay</button>
                </div>
            </form>
            
            <button type="button" onclick="handleHideModals()" class="w-full mt-4 px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300">Cancel</button>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

<script>
    // --- DATABASE SIMULATION ---
    const MOCK_DATA = {
        restaurants: [
            { id: 1, name: "Paradise Biryani", cuisine: "Biryani, North Indian", rating: 4.5, deliveryTime: "30-35 min", priceForTwo: "₹500", image: "https://th-i.thgim.com/public/migration_catalog/article14446358.ece/alternates/FREE_1200/13mpParadise3.jpg", lat: 17.9754, lon: 79.5941 },
            { id: 2, name: "Domino's Pizza", cuisine: "Pizza, Fast Food", rating: 4.1, deliveryTime: "25-30 min", priceForTwo: "₹400", image: "https://tse4.mm.bing.net/th/id/OIP.LKsIg6tky7nUeaJVaHch7gHaE7?rs=1&pid=ImgDetMain&o=7&rm=3", lat: 17.9720, lon: 79.5900 },
            { id: 3, name: "Subway", cuisine: "Healthy Food, Salads", rating: 4.3, deliveryTime: "20-25 min", priceForTwo: "₹350", image: "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTyUNGbZeTK5NJlnDsUGxNAbswlQEP-5Q94xQ&s", lat: 17.9780, lon: 79.5999 },
            { id: 4, name: "KFC", cuisine: "Burgers, Fast Food", rating: 4.0, deliveryTime: "35-40 min", priceForTwo: "₹450", image: "data:image/png;base64,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", lat: 17.9700, lon: 79.6010 },
            { id: 5, name: "Haritha Kakatiya", cuisine: "South Indian, Thali", rating: 4.4, deliveryTime: "40-45 min", priceForTwo: "₹600", image: "https://th.bing.com/th/id/R.d48916c06f4eea0a1da72a63712e77dd?rik=5EF445pKXMmFUA&riu=http%3a%2f%2fhydfoodguy.com%2fwp-content%2fgf-uploads%2f2018%2f06%2fdakshin_itc_kakatiya_02.jpg&ehk=8T5jp0aUFwsWWMasREUZJ4RpmkZzENsgKDpJzutMM7I%3d&risl=&pid=ImgRaw&r=0", lat: 17.9735, lon: 79.5915 },
            { id: 6, name: "Beijing Bites", cuisine: "Chinese, Thai", rating: 4.2, deliveryTime: "30-35 min", priceForTwo: "₹550", image: "https://th.bing.com/th/id/OIP.TxE2eR_uNbj3n6hwijkiqgHaFj?w=229&h=180&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3", lat: 17.9705, lon: 79.5955 },
            { id: 7, name: "Cream Stone", cuisine: "Ice Cream, Desserts", rating: 4.8, deliveryTime: "15-20 min", priceForTwo: "₹300", image: "https://placehold.co/600x400/f3e8ff/581c87?text=Cream+Stone", lat: 17.9760, lon: 79.5920 },
            { id: 8, name: "KS Bakers", cuisine: "Bakery, Snacks", rating: 4.3, deliveryTime: "20-25 min", priceForTwo: "₹250", image: "https://placehold.co/600x400/fff7ed/c2410c?text=KS+Bakers", lat: 17.9740, lon: 79.6000 },
            { id: 9, name: "Pista House", cuisine: "Haleem, Biryani", rating: 4.6, deliveryTime: "45-50 min", priceForTwo: "₹700", image: "https://placehold.co/600x400/dcfce7/14532d?text=Pista+House", lat: 17.9690, lon: 79.5980 },
            { id: 10, name: "Dosa Plaza", cuisine: "South Indian, Dosa", rating: 4.0, deliveryTime: "25-30 min", priceForTwo: "₹300", image: "https://placehold.co/600x400/fefce8/a16207?text=Dosa+Plaza", lat: 17.9711, lon: 79.5933 },
            { id: 11, name: "The Food Truck", cuisine: "Burgers, Wraps", rating: 4.1, deliveryTime: "30-35 min", priceForTwo: "₹350", image: "https://placehold.co/600x400/1e293b/f1f5f9?text=Food+Truck", lat: 17.9777, lon: 79.5966 },
            { id: 12, name: "Spice Kitchen", cuisine: "North Indian, Chinese", rating: 3.9, deliveryTime: "35-40 min", priceForTwo: "₹450", image: "https://placehold.co/600x400/fef2f2/991b1b?text=Spice+Kitchen", lat: 17.9702, lon: 79.5912 },
            { id: 13, name: "OvenStory Pizza", cuisine: "Pizza, Italian", rating: 4.3, deliveryTime: "30-35 min", priceForTwo: "₹500", image: "https://placehold.co/600x400/f5d0fe/701a75?text=OvenStory", lat: 17.9758, lon: 79.5948 },
            { id: 14, name: "Sweet Magic", cuisine: "Sweets, Snacks", rating: 4.5, deliveryTime: "20-25 min", priceForTwo: "₹200", image: "https://placehold.co/600x400/ffedd5/f97316?text=Sweet+Magic", lat: 17.9745, lon: 79.5975 }
        ],
        menu: {
            1: [{ id: 101, name: "Chicken Dum Biryani", price: 320, veg: false, rating: 4.8, image: "https://th.bing.com/th/id/OIP.p37ara1eLUpg7AR0WD9FGgHaE7?w=290&h=193&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3" }, { id: 102, name: "Mutton Biryani", price: 450, veg: false, rating: 4.9, image: "https://th.bing.com/th/id/OIP.2AVvcQ6fxepkNhAhe8VV2wHaJ4?w=136&h=181&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3" }, { id: 103, name: "Paneer Biryani", price: 280, veg: true, rating: 4.6, image: "https://th.bing.com/th/id/OIP.W_jE-_0a1btwW_hI9YF7iwHaHa?w=176&h=180&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3" }, { id: 104, name: "Chicken 65", price: 250, veg: false, rating: 4.7, image: "https://th.bing.com/th/id/OIP.ga3Qt0FCuYmNpTWUYjx8GQHaJN?w=153&h=189&c=7&r=0&o=7&dpr=1.3&pid=1.7&rm=3" }],
            2: [{ id: 201, name: "Margherita Pizza", price: 299, veg: true, rating: 4.4, image: "https://placehold.co/100x100/dbeafe/1d4ed8?text=Pizza" }, { id: 202, name: "Pepperoni Pizza", price: 459, veg: false, rating: 4.6, image: "https://placehold.co/100x100/dbeafe/1e3a8a?text=Pepperoni" }, { id: 203, name: "Garlic Breadsticks", price: 149, veg: true, rating: 4.5, image: "https://placehold.co/100x100/e0e7ff/312e81?text=Garlic+Bread" }, { id: 204, name: "Choco Lava Cake", price: 99, veg: true, rating: 4.8, image: "https://placehold.co/100x100/e5e7eb/1f2937?text=Cake" }],
            3: [{ id: 301, name: "Veggie Delite Salad", price: 220, veg: true, rating: 4.5, image: "https://placehold.co/100x100/d1fae5/059669?text=Salad" }, { id: 302, name: "Chicken Teriyaki Sub", price: 350, veg: false, rating: 4.3, image: "https://placehold.co/100x100/d1fae5/047857?text=Chicken+Sub" }, { id: 303, name: "Paneer Tikka Sub", price: 280, veg: true, rating: 4.4, image: "https://placehold.co/100x100/d1fae5/065f46?text=Paneer+Sub" }, { id: 304, name: "Cookie", price: 60, veg: true, rating: 4.7, image: "https://placehold.co/100x100/f0fdf4/14532d?text=Cookie" }],
            4: [{ id: 401, name: "8 pc Hot & Crispy", price: 699, veg: false, rating: 4.2, image: "https://placehold.co/100x100/fee2e2/b91c1c?text=Fried+Chicken" }, { id: 402, name: "Zinger Burger", price: 199, veg: false, rating: 4.3, image: "https://placehold.co/100x100/fee2e2/991b1b?text=Burger" }, { id: 403, name: "Popcorn Chicken", price: 150, veg: false, rating: 4.1, image: "https://placehold.co/100x100/fee2e2/7f1d1d?text=Popcorn" }, { id: 404, name: "Fries (Large)", price: 99, veg: true, rating: 3.9, image: "https://placehold.co/100x100/fef3c7/b45309?text=Fries" }],
            5: [{ id: 501, name: "South Indian Thali", price: 250, veg: true, rating: 4.5, image: "https://placehold.co/100x100/a7f3d0/047857?text=Thali" }, { id: 502, name: "Paneer Butter Masala", price: 220, veg: true, rating: 4.3, image: "https://placehold.co/100x100/a7f3d0/065f46?text=Paneer" }, { id: 503, name: "Chicken Chettinad", price: 280, veg: false, rating: 4.6, image: "https://placehold.co/100x100/a7f3d0/064e3b?text=Chicken" }],
            6: [{ id: 601, name: "Veg Hakka Noodles", price: 180, veg: true, rating: 4.1, image: "https://placehold.co/100x100/fecdd3/881337?text=Noodles" }, { id: 602, name: "Chicken Manchurian", price: 240, veg: false, rating: 4.3, image: "https://placehold.co/100x100/fecdd3/9f1239?text=Manchurian" }, { id: 603, name: "Thai Green Curry (Veg)", price: 260, veg: true, rating: 4.2, image: "https://placehold.co/100x100/fecdd3/be185d?text=Curry" }],
            7: [{ id: 701, name: "Willy Wonka", price: 199, veg: true, rating: 4.9, image: "https://placehold.co/100x100/f3e8ff/581c87?text=Wonka" }, { id: 702, name: "Choco Lava", price: 180, veg: true, rating: 4.7, image: "https://placehold.co/100x100/f3e8ff/6b21a8?text=Lava" }, { id: 703, name: "Fruit Exotica", price: 210, veg: true, rating: 4.6, image: "https://placehold.co/100x100/f3e8ff/7e22ce?text=Fruit" }],
            8: [{ id: 801, name: "Black Forest Cake (1lb)", price: 450, veg: true, rating: 4.4, image: "https://placehold.co/100x100/fff7ed/c2410c?text=Cake" }, { id: 802, name: "Veg Puff", price: 30, veg: true, rating: 4.2, image: "https://placehold.co/100x100/fff7ed/d97706?text=Puff" }, { id: 803, name: "Chicken 65 Roll", price: 80, veg: false, rating: 4.1, image: "https://placehold.co/100x100/fff7ed/ea580c?text=Roll" }],
            9: [{ id: 901, name: "Mutton Haleem", price: 250, veg: false, rating: 4.9, image: "https://placehold.co/100x100/dcfce7/14532d?text=Haleem" }, { id: 902, name: "Special Chicken Biryani", price: 380, veg: false, rating: 4.7, image: "https://placehold.co/100x100/dcfce7/15803d?text=Biryani" }, { id: 903, name: "Qubani Ka Meetha", price: 120, veg: true, rating: 4.6, image: "https://placehold.co/100x100/dcfce7/16a34a?text=Sweet" }],
            10: [{ id: 1001, name: "Masala Dosa", price: 90, veg: true, rating: 4.0, image: "https://placehold.co/100x100/fefce8/a16207?text=Dosa" }, { id: 1002, name: "Paneer Cheese Dosa", price: 150, veg: true, rating: 4.3, image: "https://placehold.co/100x100/fefce8/b45309?text=Paneer+Dosa" }, { id: 1003, name: "Idli Sambar", price: 70, veg: true, rating: 3.9, image: "https://placehold.co/100x100/fefce8/d97706?text=Idli" }],
            11: [{ id: 1101, name: "Classic Chicken Burger", price: 180, veg: false, rating: 4.2, image: "https://placehold.co/100x100/e2e8f0/0f172a?text=Burger" }, { id: 1102, name: "Peri Peri Fries", price: 120, veg: true, rating: 4.0, image: "https://placehold.co/100x100/e2e8f0/1e293b?text=Fries" }, { id: 1103, name: "Falafel Wrap", price: 160, veg: true, rating: 4.1, image: "https://placehold.co/100x100/e2e8f0/334155?text=Wrap" }],
            12: [{ id: 1201, name: "Butter Chicken", price: 320, veg: false, rating: 4.0, image: "https://placehold.co/100x100/fef2f2/991b1b?text=Butter+Chicken" }, { id: 1202, name: "Dal Makhani", price: 250, veg: true, rating: 3.9, image: "https://placehold.co/100x100/fef2f2/b91c1c?text=Dal" }, { id: 1203, name: "Garlic Naan", price: 60, veg: true, rating: 4.1, image: "https://placehold.co/100x100/fef2f2/dc2626?text=Naan" }],
            13: [{ id: 1301, name: "Famous Five Pizza", price: 549, veg: false, rating: 4.4, image: "https://placehold.co/100x100/f5d0fe/701a75?text=Pizza" }, { id: 1302, name: "Full Cheese Pizza", price: 499, veg: true, rating: 4.2, image: "https://placehold.co/100x100/f5d0fe/86198f?text=Cheese+Pizza" }, { id: 1303, name: "Garlic Bread with Cheese", price: 159, veg: true, rating: 4.3, image: "https://placehold.co/100x100/f5d0fe/9d174d?text=Bread" }],
            14: [{ id: 1401, name: "Kaju Katli (250g)", price: 220, veg: true, rating: 4.6, image: "https://placehold.co/100x100/ffedd5/f97316?text=Kaju" }, { id: 1402, name: "Motichoor Laddu (250g)", price: 180, veg: true, rating: 4.5, image: "https://placehold.co/100x100/ffedd5/ea580c?text=Laddu" }, { id: 1403, name: "Samosa (2 pcs)", price: 50, veg: true, rating: 4.3, image: "https://placehold.co/100x100/ffedd5/c2410c?text=Samosa" }]
        },
        categories: [
            { name: 'Pizza', icon: '🍕' }, { name: 'Burger', icon: 'hamburger' }, { name: 'Biryani', icon: 'utensils-crossed' }, { name: 'Thali', icon: 'box' },
            { name: 'Rolls', icon: 'drumstick' }, { name: 'Salad', icon: 'leaf' }, { name: 'Cake', icon: 'cake' }, { name: 'Dosa', icon: 'circle' }
        ]
    };

    // --- SVG ICONS ---
    const ICONS = {
        star: `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-star text-white"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
        back: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-arrow-left"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
        veg: `<svg width="16" height="16" viewBox="0 0 24 24" fill="#22c55e" class="border border-green-600"><circle cx="12" cy="12" r="10"></circle></svg>`,
        nonveg: `<svg width="16" height="16" viewBox="0 0 24 24" fill="#ef4444" class="border border-red-600"><circle cx="12" cy="12" r="10"></circle></svg>`,
        check: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-check text-white"><path d="M20 6 9 17l-5-5"/></svg>`
    };

    // --- STRATEGY PATTERN (Delivery Fee) ---
    class FeeStrategy {
        calculate(subtotal) { throw new Error("This method must be overridden!"); }
    }
    class StandardFeeStrategy extends FeeStrategy {
        calculate(subtotal) { return 30.00; }
    }
    class ExpressFeeStrategy extends FeeStrategy {
        calculate(subtotal) { return 60.00; }
    }
    class FreeDeliveryStrategy extends FeeStrategy {
        calculate(subtotal) { return 0.00; }
    }
    class FeeCalculator {
        constructor() { this.strategy = new StandardFeeStrategy(); }
        setStrategy(strategy) { this.strategy = strategy; }
        calculate(subtotal) { return this.strategy.calculate(subtotal); }
    }
    // --- END STRATEGY PATTERN ---


    // --- OBSERVER PATTERN (Order Notification) ---
    class Subject {
        constructor() { this.observers = []; }
        subscribe(observer) { this.observers.push(observer); }
        unsubscribe(observer) { this.observers = this.observers.filter(obs => obs !== observer); }
        notify(data) { this.observers.forEach(observer => observer.update(data)); }
    }

    class OrderService extends Subject {
        constructor() {
            super();
        }

        // NEW: Assigns an agent to the order object
        assignAgentToOrder(order) {
            if (this.observers.length === 0) {
                console.error("No delivery agents are subscribed!");
                order.agent = { name: "Bot", phone: "N/A" }; // Fallback
                return;
            }
            // For simulation, just pick a random agent from the subscribed list
            const assignedAgent = this.observers[Math.floor(Math.random() * this.observers.length)];
            
            // Attach agent details to the order
            order.agent = {
                name: assignedAgent.name,
                phone: assignedAgent.phoneNumber
            };
            
            console.log(`OrderService: Assigned ${assignedAgent.name} to order ${order.id}.`);
        }

        placeNewOrder(order) {
            // This method just handles the notification part
            console.log("OrderService: New order placed. Notifying observers...");
            this.notify(order); // Notify all subscribed observers
        }
    }

    class Observer {
        update(data) { throw new Error("This method must be overridden!"); }
    }

    class DeliveryAgent extends Observer {
        // NEW: Constructor now takes name AND phone number
        constructor(name, phoneNumber) {
            super();
            this.name = name;
            this.phoneNumber = phoneNumber;
        }

        update(order) {
            // NEW: Logic to check if this agent was the one assigned
            if (order.agent && order.agent.name === this.name) {
                console.log(`%cDeliveryAgent (${this.name}): "I've accepted order ${order.id}! I'm on my way."`, "color: blue; font-weight: bold;");
            } else {
                // Other agents are just notified that an order is taken
                console.log(`%cDeliveryAgent (${this.name}): "New order ${order.id} is available for pickup."`, "color: gray;");
            }
        }
    }
    // --- END OBSERVER PATTERN ---


    // --- COMMAND PATTERN (User Actions) ---
    class Command {
        execute() { throw new Error("This method must be overridden!"); }
    }
    class NavigateCommand extends Command {
        constructor(app, page, context) { super(); this.app = app; this.page = page; this.context = context; }
        execute() { this.app.navigateTo(this.page, this.context); }
    }
    class AddToCartCommand extends Command {
        constructor(app, itemId, restaurantId) { super(); this.app = app; this.itemId = itemId; this.restaurantId = restaurantId; }
        execute() { this.app.cart.addToCart(this.itemId, this.restaurantId); }
    }
    class UpdateQuantityCommand extends Command {
        constructor(app, itemId, change) { super(); this.app = app; this.itemId = itemId; this.change = change; }
        execute() { this.app.cart.updateQuantity(this.itemId, this.change); }
    }
    class PlaceOrderCommand extends Command {
        constructor(app) { super(); this.app = app; }
        execute() { this.app.placeOrder(); }
    }
    class ConfirmOrderCommand extends Command {
        constructor(app) { super(); this.app = app; }
        execute() { this.app.confirmOrder(); }
    }
    class HideModalsCommand extends Command {
        constructor(app) { super(); this.app = app; }
        execute() { this.app.hideModals(); }
    }
    // --- END COMMAND PATTERN ---


    // --- CORE APPLICATION CLASSES ---
    class Cart {
        constructor(app) {
            this.app = app;
            this.items = [];
            this.restaurantId = null;
            this.feeCalculator = new FeeCalculator();
        }

        addToCart(itemId, restaurantId) {
            if (this.items.length > 0 && this.restaurantId !== restaurantId) {
                this.app.showToast("Clear cart to order from a new restaurant.", true);
                return;
            }

            this.restaurantId = restaurantId;
            const menuItem = MOCK_DATA.menu[restaurantId].find(item => item.id === itemId);
            const cartItem = this.items.find(item => item.id === itemId);

            if (cartItem) {
                cartItem.quantity++;
            } else {
                this.items.push({ ...menuItem, quantity: 1, restaurantId });
            }
            this.app.updateCartCount();
            this.app.showToast(`${menuItem.name} added to cart`);
        }

        updateQuantity(itemId, change) {
            const cartItem = this.items.find(item => item.id === itemId);
            if (cartItem) {
                cartItem.quantity += change;
                if (cartItem.quantity <= 0) {
                    this.items = this.items.filter(item => item.id !== itemId);
                    if (this.items.length === 0) {
                        this.restaurantId = null;
                    }
                }
            }
            this.app.updateCartCount();
            this.app.renderCartPage();
        }

        getCount() {
            return this.items.reduce((sum, item) => sum + item.quantity, 0);
        }

        clearCart() {
            this.items = [];
            this.restaurantId = null;
        }
        
        getBillDetails() {
            const subtotal = this.items.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const deliveryFee = this.feeCalculator.calculate(subtotal);
            const taxes = subtotal * 0.18;
            const total = subtotal + deliveryFee + taxes;
            
            return { subtotal, deliveryFee, taxes, total };
        }
        
        setDeliveryStrategy(strategyKey) {
            switch(strategyKey) {
                case 'express': this.feeCalculator.setStrategy(new ExpressFeeStrategy()); break;
                case 'free': this.feeCalculator.setStrategy(new FreeDeliveryStrategy()); break;
                case 'standard': default: this.feeCalculator.setStrategy(new StandardFeeStrategy()); break;
            }
            this.app.renderCartPage();
        }
    }


    class App {
        constructor() {
            this.currentPage = 'home';
            this.currentRestaurant = null;
            this.currentOrder = null;
            this.map = null;
            this.deliveryAnimation = null;
            this.statusInterval = null;

            this.cart = new Cart(this);
            this.orderService = new OrderService();
            
            // --- OBSERVER PATTERN Setup ---
            // NEW: Create agents with names AND phone numbers
            this.agentRaju = new DeliveryAgent("Raju", "98765-43210");
            this.agentSunita = new DeliveryAgent("Sunita", "91234-56789");
            
            // Subscribe them to the order service
            this.orderService.subscribe(this.agentRaju);
            this.orderService.subscribe(this.agentSunita);
            // ---
        }

        init() {
            this.renderHomePage();
            this.updateHeader('home');
            this.initSplash();
            this.initSearch();
        }

        initSplash() {
            const splash = document.getElementById('splash-screen');
            setTimeout(() => {
                splash.style.opacity = '0';
                setTimeout(() => splash.classList.add('hidden'), 500);
            }, 2500);
        }
        
        initSearch() {
            const searchInput = document.getElementById('search-input');
            searchInput.addEventListener('input', (e) => this.handleSearch(e));
            searchInput.addEventListener('focus', (e) => this.handleSearch(e));

            document.addEventListener('click', (event) => {
                const searchContainer = searchInput.parentElement;
                if (searchContainer && !searchContainer.contains(event.target)) {
                    document.getElementById('search-results').classList.add('hidden');
                }
            });
        }
        
        navigateTo(page, context = {}) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(`page-${page}`).classList.add('active');
            this.currentPage = page;
            window.scrollTo(0, 0);
            this.updateHeader(page, context);

            if (page !== 'tracking' && this.deliveryAnimation) clearInterval(this.deliveryAnimation);
            if (page !== 'tracking' && this.statusInterval) clearInterval(this.statusInterval);

            switch(page) {
                case 'home': this.renderHomePage(); break;
                case 'restaurant': this.renderRestaurantPage(context.restaurantId); break;
                case 'cart': this.renderCartPage(); break;
                case 'tracking':
                    this.renderTrackingPage(); // Renders the agent details
                    setTimeout(() => this.initializeMapAndTracking(), 100); // Starts the map/animation
                    break;
            }
        }
        
        updateHeader(page, context) {
            const headerContent = document.getElementById('header-content');
            switch (page) {
                case 'restaurant': case 'cart': case 'tracking':
                    headerContent.innerHTML = `<button onclick="handleNavigate('home')" class="p-1">${ICONS.back}</button>`;
                    break;
                case 'home': default:
                    headerContent.innerHTML = `<div><h1 class="text-xl font-bold text-red-600">Zoom Delivery</h1><p class="text-xs text-gray-500">Hanamkonda, Telangana</p></div>`;
                    break;
            }
        }
        
        renderHomePage() {
            const categoriesContainer = document.getElementById('categories-container');
            categoriesContainer.innerHTML = MOCK_DATA.categories.map(cat => `
                <div class="flex flex-col items-center space-y-2 cursor-pointer" onclick="handleSearchByCategory('${cat.name}')">
                    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center">
                        <img src="https://placehold.co/64x64/f3f4f6/ef4444?text=${cat.name.substring(0,1)}" class="rounded-full" />
                    </div>
                    <span class="text-sm font-medium">${cat.name}</span>
                </div>
            `).join('');

            const restaurantList = document.getElementById('restaurant-list');
            restaurantList.innerHTML = MOCK_DATA.restaurants.map(r => `
                <div class="rounded-lg overflow-hidden border bg-white shadow-sm cursor-pointer hover:shadow-lg transition-shadow" onclick="handleNavigate('restaurant', { restaurantId: ${r.id} })">
                    <img src="${r.image}" alt="${r.name}" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <div class="flex justify-between items-center">
                            <h3 class="text-lg font-bold">${r.name}</h3>
                            <div class="bg-green-600 text-white text-sm font-bold px-2 py-1 rounded flex items-center gap-1">
                                ${r.rating} ${ICONS.star}
                            </div>
                        </div>
                        <p class="text-gray-600 text-sm">${r.cuisine}</p>
                        <p class="text-gray-600 text-sm mt-1">${r.deliveryTime} • ${r.priceForTwo} for two</p>
                    </div>
                </div>
            `).join('');
        }

        renderRestaurantPage(restaurantId) {
            const restaurant = MOCK_DATA.restaurants.find(r => r.id === restaurantId);
            this.currentRestaurant = restaurant;
            const menu = MOCK_DATA.menu[restaurantId];
            
            const content = document.getElementById('restaurant-detail-content');
            content.innerHTML = `
                <div class="md:flex md:gap-8">
                    <div class="md:w-1/3">
                        <img src="${restaurant.image}" class="w-full h-48 object-cover rounded-lg mb-4">
                        <h2 class="text-3xl font-bold">${restaurant.name}</h2>
                        <p class="text-gray-500">${restaurant.cuisine}</p>
                         <div class="flex items-center gap-4 text-sm mt-2">
                             <div class="bg-green-600 text-white font-bold px-2 py-1 rounded flex items-center gap-1">${restaurant.rating} ${ICONS.star}</div>
                             <span>${restaurant.deliveryTime}</span>
                         </div>
                          <p class="text-gray-600 text-sm mt-1">${restaurant.priceForTwo} for two</p>
                    </div>
                    <div class="md:w-2/3">
                        <h3 class="text-xl font-bold mt-8 mb-4 border-t pt-4 md:mt-0 md:border-t-0 md:pt-0">Menu</h3>
                        <div class="space-y-4">
                            ${menu.map(item => `
                                <div class="flex items-start justify-between p-3 border-b">
                                    <div class="flex-grow">
                                        <div class="flex items-center gap-2 mb-1">${item.veg ? ICONS.veg : ICONS.nonveg} <span class="font-semibold">${item.name}</span></div>
                                        <p class="text-sm text-gray-500">Rating: ${item.rating}/5.0</p>
                                        <p class="font-semibold mt-2">₹${item.price.toFixed(2)}</p>
                                    </div>
                                    <div class="flex-shrink-0 text-center ml-4">
                                         <img src="${item.image.replace(/_\/\//g, 'https://')}" class="w-24 h-24 rounded-md object-cover">
                                         <button onclick="handleAddToCart(${item.id}, ${restaurantId})" class="w-24 -mt-4 relative bg-white border border-gray-300 text-red-500 font-bold py-1 px-4 rounded-lg shadow-md hover:bg-red-50 transition-colors">ADD</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        renderCartPage() {
            const cartItemsContainer = document.getElementById('cart-items');
            const paymentSection = document.getElementById('payment-section');
            const emptyCartMessage = document.getElementById('empty-cart');
            const billDetailsContainer = document.getElementById('bill-details');

            if (this.cart.items.length === 0) {
                cartItemsContainer.innerHTML = '';
                paymentSection.classList.add('hidden');
                emptyCartMessage.classList.remove('hidden');
                return;
            }

            emptyCartMessage.classList.add('hidden');
            paymentSection.classList.remove('hidden');
            
            cartItemsContainer.innerHTML = this.cart.items.map(item => `
                <div class="flex items-center justify-between p-2 border rounded-lg bg-white">
                     <img src="${item.image.replace(/_\/\//g, 'https://')}" class="w-12 h-12 rounded-md object-cover mr-4">
                    <div class="flex-grow">
                        <p class="font-semibold">${item.name}</p>
                        <p class="text-sm text-gray-600">₹${item.price.toFixed(2)}</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button onclick="handleUpdateQuantity(${item.id}, -1)" class="w-7 h-7 bg-gray-200 rounded-full font-bold">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="handleUpdateQuantity(${item.id}, 1)" class="w-7 h-7 bg-red-500 text-white rounded-full font-bold">+</button>
                    </div>
                </div>
            `).join('');

            const { subtotal, deliveryFee, taxes, total } = this.cart.getBillDetails();

            billDetailsContainer.innerHTML = `
                <div class="flex justify-between"><span>Item Total</span><span>₹${subtotal.toFixed(2)}</span></div>
                <div class="flex justify-between"><span>Delivery Fee</span><span>₹${deliveryFee.toFixed(2)}</span></div>
                <div class="flex justify-between border-b pb-2"><span>Taxes & Charges</span><span>₹${taxes.toFixed(2)}</span></div>
                <div class="flex justify-between font-bold text-lg text-black mt-2"><span>To Pay</span><span>₹${total.toFixed(2)}</span></div>
            `;
        }
        
        renderTrackingPage() {
            // --- NEW: Render Agent Details ---
            const agentDetailsContainer = document.getElementById('agent-details');
            if (this.currentOrder && this.currentOrder.agent) {
                const agent = this.currentOrder.agent;
                agentDetailsContainer.innerHTML = `
                    <h3 class="text-xl font-semibold mb-3">Your Delivery Agent</h3>
                    <div class="flex items-center gap-4 p-4 border rounded-lg bg-white shadow-sm">
                        <img src="https://placehold.co/64x64/f3f4f6/ef4444?text=${agent.name.substring(0,1)}" class="w-16 h-16 rounded-full flex-shrink-0" />
                        <div>
                            <p class="text-lg font-bold">${agent.name}</p>
                            <p class="text-gray-600">Ph: ${agent.phone}</p>
                            <a href="tel:${agent.phone.replace(/-/g, '')}" class="text-red-600 font-medium hover:underline">Call Agent</a>
                        </div>
                    </div>
                `;
            } else {
                agentDetailsContainer.innerHTML = ''; // Clear it if no agent
            }
            // ---

            const trackingStatusContainer = document.getElementById('tracking-status');
            const statuses = [
                { id: 1, text: "Order Placed", detail: "We have received your order.", done: false },
                { id: 2, text: "Order Confirmed", detail: "Your order has been confirmed.", done: false },
                { id: 3, text: "Preparing your Order", detail: "The restaurant is preparing your food.", done: false },
                { id: 4, text: "Out for Delivery", detail: "Your agent is on the way!", done: false },
                { id: 5, text: "Delivered", detail: "Enjoy your meal!", done: false }
            ];
            let currentStatusIndex = 0;

            const updateStatus = () => {
                if (currentStatusIndex < statuses.length) {
                    statuses[currentStatusIndex].done = true;
                    trackingStatusContainer.innerHTML = statuses.map((status, index) => `
                        <div class="flex">
                            <div class="flex flex-col items-center mr-4">
                                <div>
                                    <div class="flex items-center justify-center w-10 h-10 border-2 ${status.done ? 'bg-red-500 border-red-500' : 'border-gray-300'} rounded-full">
                                        ${status.done ? ICONS.check : ''}
                                    </div>
                                </div>
                                ${index < statuses.length - 1 ? `<div class="w-px h-full ${statuses[index + 1] && statuses[index + 1].done ? 'bg-red-500' : 'bg-gray-300'}"></div>` : ''}
                            </div>
                            <div class="pb-8">
                                <p class="font-semibold ${status.done ? 'text-black' : 'text-gray-400'}">${status.text}</p>
                                <p class="text-sm text-gray-500">${status.detail}</p>
                            </div>
                        </div>
                    `).join('');
                    currentStatusIndex++;
                } else {
                     clearInterval(this.statusInterval);
                }
            };
            
            if (this.statusInterval) clearInterval(this.statusInterval);
            updateStatus();
            this.statusInterval = setInterval(updateStatus, 5000);
        }

        initializeMapAndTracking() {
            if (this.map) {
                this.map.remove();
                this.map = null;
            }

            const restaurantLocation = MOCK_DATA.restaurants.find(r => r.id === this.currentOrder.restaurantId);
            const homeLocation = { lat: 17.9689, lon: 79.5940 };

            this.map = L.map('map').setView([homeLocation.lat, homeLocation.lon], 15);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '© OpenStreetMap' }).addTo(this.map);

            L.marker([restaurantLocation.lat, restaurantLocation.lon]).addTo(this.map).bindPopup(`<b>${restaurantLocation.name}</b>`);
            L.marker([homeLocation.lat, homeLocation.lon]).addTo(this.map).bindPopup("<b>Your Location</b>");
            
            const deliveryIcon = L.divIcon({
                html: `<div class="relative"><svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="#ef4444" stroke="white" stroke-width="1" class="drop-shadow-lg"><circle cx="12" cy="12" r="11"/><path d="m14 9-3 3 3 3"/><path d="M10.5 12H16"/><path d="M7 12h2.5"/><path d="M12 7v2.5"/><path d="M12 14.5V17"/><circle cx="12" cy="12" r="2"/></svg><span class="absolute text-2xl" style="top: 50%; left: 50%; transform: translate(-50%, -50%);">🏍️</span></div>`,
                className: '', iconSize: [40, 40], iconAnchor: [20, 20]
            });
            const deliveryBoy = L.marker([restaurantLocation.lat, restaurantLocation.lon], { icon: deliveryIcon }).addTo(this.map);

            let step = 0;
            const totalSteps = 200;
            const latStep = (homeLocation.lat - restaurantLocation.lat) / totalSteps;
            const lonStep = (homeLocation.lon - restaurantLocation.lon) / totalSteps;
            
            const deliveryStatusEl = document.getElementById('delivery-status');
            const deliveryStatusDesktopEl = document.getElementById('delivery-status-desktop');

            const updateDeliveryText = (text) => {
                deliveryStatusEl.textContent = text;
                deliveryStatusDesktopEl.textContent = text;
            };
            
            // --- NEW: Use dynamic agent name ---
            const agentName = this.currentOrder.agent ? this.currentOrder.agent.name : "Your agent";
            updateDeliveryText(`${agentName} is picking up your order...`);

            if (this.deliveryAnimation) clearInterval(this.deliveryAnimation);

            this.deliveryAnimation = setInterval(() => {
                if (step >= totalSteps) {
                    clearInterval(this.deliveryAnimation);
                    updateDeliveryText(`${agentName} has arrived!`);
                    return;
                }
                const newLat = restaurantLocation.lat + (latStep * step);
                const newLon = restaurantLocation.lon + (lonStep * step);
                deliveryBoy.setLatLng([newLat, newLon]);
                this.map.panTo([newLat, newLon]);
                
                if (step > 20 && deliveryStatusEl.textContent === `${agentName} is picking up your order...`) updateDeliveryText(`${agentName} is on the way!`);
                if (step > totalSteps * 0.75 && deliveryStatusEl.textContent === `${agentName} is on the way!`) updateDeliveryText(`${agentName} is near your location!`);

                step++;
            }, 150);
        }
        
        placeOrder() {
            if (this.cart.items.length === 0) {
                this.showToast("Your cart is empty!", true);
                return;
            }

            const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
            const totalAmount = this.cart.getBillDetails().total.toFixed(2);

            switch(paymentMethod) {
                case 'card':
                    document.getElementById('card-modal').classList.remove('hidden');
                    document.getElementById('card-modal-amount').textContent = `₹${totalAmount}`;
                    break;
                case 'upi':
                    document.getElementById('upi-modal').classList.remove('hidden');
                    document.getElementById('upi-modal-amount').textContent = `₹${totalAmount}`;
                    break;
                case 'cod':
                    this.confirmOrder();
                    break;
            }
        }
        
        confirmOrder() {
            if (this.cart.items.length === 0) return;
            this.hideModals(); 
            
            const bill = this.cart.getBillDetails();
            const restaurant = MOCK_DATA.restaurants.find(r => r.id === this.cart.restaurantId);
            
            this.currentOrder = {
                id: 'ORD' + Date.now(),
                items: [...this.cart.items],
                restaurantId: this.cart.restaurantId,
                restaurantName: restaurant.name,
                total: bill.total.toFixed(2),
                agent: null // Placeholder for agent
            };
            
            // --- OBSERVER/ASSIGNMENT ---
            // 1. Assign a specific agent to the order
            this.orderService.assignAgentToOrder(this.currentOrder);
            
            // 2. Notify all agents (so they know a new order is taken/available)
            this.orderService.placeNewOrder(this.currentOrder);
            // ---
            
            this.cart.clearCart();
            this.updateCartCount();
            this.navigateTo('tracking');
        }
        
        hideModals() {
            document.getElementById('card-modal').classList.add('hidden');
            document.getElementById('upi-modal').classList.add('hidden');
        }

        updateCartCount() {
            document.getElementById('cart-item-count').textContent = this.cart.getCount();
        }

        showToast(message, isError = false) {
            const toast = document.createElement('div');
            const bgColor = isError ? 'bg-yellow-500' : 'bg-gray-800';
            toast.className = `fixed bottom-5 left-1/2 -translate-x-1/2 ${bgColor} text-white px-4 py-2 rounded-lg shadow-lg transition-opacity duration-300 opacity-0 z-50`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => toast.style.opacity = 1, 10);
            setTimeout(() => {
                toast.style.opacity = 0;
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        handleSearch(event) {
            const query = event.target.value.toLowerCase().trim();
            const resultsContainer = document.getElementById('search-results');
            if (query.length < 2) {
                resultsContainer.innerHTML = '';
                resultsContainer.classList.add('hidden');
                return;
            }
            resultsContainer.classList.remove('hidden');
            let resultsHtml = '';
            const matchingRestaurants = MOCK_DATA.restaurants.filter(r => r.name.toLowerCase().includes(query) || r.cuisine.toLowerCase().includes(query));
            if (matchingRestaurants.length > 0) {
                resultsHtml += '<h3 class="px-3 py-2 text-sm font-bold text-gray-500 bg-gray-50">Restaurants</h3>';
                resultsHtml += matchingRestaurants.map(r => `
                    <div class="p-3 hover:bg-gray-100 cursor-pointer flex items-center gap-4 border-b" onclick="handleNavigate('restaurant', { restaurantId: ${r.id} })">
                        <img src="${r.image}" class="w-12 h-12 rounded-md object-cover flex-shrink-0">
                        <div><p class="font-semibold">${r.name}</p><p class="text-xs text-gray-500">${r.cuisine}</p></div>
                    </div>`).join('');
            }
            let matchingItems = [];
            for (const restaurantId in MOCK_DATA.menu) {
                MOCK_DATA.menu[restaurantId].forEach(item => {
                    if (item.name.toLowerCase().includes(query)) {
                        const restaurant = MOCK_DATA.restaurants.find(r => r.id == restaurantId);
                        matchingItems.push({ ...item, restaurantName: restaurant.name, restaurantId: restaurant.id });
                    }
                });
            }
            if (matchingItems.length > 0) {
                resultsHtml += '<h3 class="px-3 py-2 text-sm font-bold text-gray-500 bg-gray-50 border-t">Dishes</h3>';
                resultsHtml += matchingItems.slice(0, 10).map(item => `
                    <div class="p-3 hover:bg-gray-100 cursor-pointer flex items-center justify-between border-b" onclick="handleNavigate('restaurant', { restaurantId: ${item.restaurantId} })">
                        <img src="${item.image.replace(/_\/\//g, 'https://')}" class="w-12 h-12 rounded-md object-cover flex-shrink-0 mr-3">
                        <div class="flex-grow">
                            <div class="flex items-center gap-2">${item.veg ? ICONS.veg : ICONS.nonveg} <p class="font-semibold">${item.name}</p></div>
                            <p class="text-xs text-gray-500 ml-6">In ${item.restaurantName}</p>
                        </div>
                        <button onclick="handleAddToCart(${item.id}, ${item.restaurantId})" class="bg-red-50 text-red-600 font-bold py-1 px-3 rounded-lg text-sm whitespace-nowrap hover:bg-red-100">ADD</button>
                    </div>`).join('');
            }
            resultsContainer.innerHTML = resultsHtml || '<p class="p-4 text-center text-gray-500">No results found.</p>';
        }

        searchByCategory(categoryName) {
            const searchInput = document.getElementById('search-input');
            searchInput.value = categoryName;
            const event = new Event('input', { bubbles: true });
            searchInput.dispatchEvent(event);
            searchInput.focus();
        }
    }


    // --- GLOBAL HANDLERS (Invoking Command Pattern) ---
    let app; // Global app instance

    function handleNavigate(page, context = {}) {
        new NavigateCommand(app, page, context).execute();
    }
    function handleAddToCart(itemId, restaurantId) {
        if (event) event.stopPropagation();
        new AddToCartCommand(app, itemId, restaurantId).execute();
    }
    function handleUpdateQuantity(itemId, change) {
        new UpdateQuantityCommand(app, itemId, change).execute();
    }
    function handlePlaceOrder() {
        new PlaceOrderCommand(app).execute();
    }
    function handleConfirmOrder() {
        new ConfirmOrderCommand(app).execute();
    }
    function handleHideModals() {
        new HideModalsCommand(app).execute();
    }
    function handleSearchByCategory(categoryName) {
        app.searchByCategory(categoryName);
    }
    function handleDeliveryStrategyChange(event) {
        const strategyKey = event.target.value;
        app.cart.setDeliveryStrategy(strategyKey);
    }

    // --- INITIALIZATION ---
    window.onload = () => {
        // Image URL Fixer: The provided MOCK_DATA has broken image URLs. Let's fix them.
        const fixImageUrls = (menuData) => {
            for (const key in menuData) {
                menuData[key].forEach(item => {
                    if (item.image) {
                        item.image = item.image.replace(/_\/\//g, 'https://').replace(/https\.\.\./g, 'https://');
                    }
                    if (item.image.endsWith("What")) { // Fix for a specific typo in the data
                         item.image = "https://placehold.co/100x100/fef2f2/dc2626?text=Naan";
                    }
                });
            }
        };
        fixImageUrls(MOCK_DATA.menu);

        app = new App();
        app.init();
    };

</script>
</body>
</html>